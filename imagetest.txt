*** Settings ***
Suite Setup    Set CLI ENV ready
Suite Teardown    Close All Connections
Resource    ./common/assets/secrets.txt
Resource    ./common/assets/resource.txt
Resource    local_resource.txt
#Library    NovaClient
Library    SSHLibrary
Library    OperatingSystem

*** Variables ***
${USERNAME}     debian
${ID_RSA}    /home/user/.ssh/id_rsa
${KEYRING_PASS}    ${EMPTY}
#${PASSWORD}    ${VALID_PASSWORD}
#${HOST}     support-test.forgeservicelab.fi
${HOST}      193.166.25.155
${FLAVOR}    m1.tiny 

*** Test Cases ***

Run-Keyword-If
    Run Keyword If    '${FLAVOR}' == 'm1.tiny'     test_m1_tiny
    Run Keyword If    '${FLAVOR}' == 'm1.small'     test_m1_small
    Run Keyword If    '${FLAVOR}' == 'm1.medium'     test_m1_medium
    Run Keyword If    '${FLAVOR}' == 'm1.large'     test_m1_large
    Run Keyword If    '${FLAVOR}' == 'm1.xlarge'     test_m1_xlarge

*** Keywords ***
test_m1_tiny
    Open Connection    ${HOST}
    ${resp}    Login With Public Key    ${username}    ${ID_RSA}    ${KEYRING_PASS}
    Should Contain    ${resp}    Last login
    Log    CPU(s)
    ${output}    Execute Command    lscpu | grep CPU
    Should Contain     ${output}    CPU(s): ${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}1
    Log    Memory
    ${output}    Execute Command    free -mh | grep Mem
    Should Contain     ${output}    Mem:${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}1.0G
    Log    DISK
    ${output}    Execute Command    df -h | grep rootfs
    Should Contain     ${output}    rootfs${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}9.9G
    Log    Reached this point despite of error
test_m1_small
    Open Connection    ${HOST}
    ${resp}    Login With Public Key    ${username}    ${ID_RSA}
    Should Contain    ${resp}    Last login
    Log    CPU(s)
    ${output}    Execute Command    lscpu | grep CPU
    Should Contain     ${output}    CPU(s): ${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}1
    Log    Memory
    ${output}    Execute Command    free -mh | grep Mem
    Should Contain     ${output}    Mem:${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}2.0G
    Log    DISK
    ${output}    Execute Command    df -h | grep rootfs
    Should Contain     ${output}    rootfs${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}9.9G
    Log    Reached this point despite of error
test_m1_medium
    Open Connection    ${HOST}
    ${resp}    Login With Public Key    ${username}    ${ID_RSA}
    Should Contain    ${resp}    Last login
    Log    CPU(s)
    ${output}    Execute Command    lscpu | grep CPU
    Should Contain     ${output}    CPU(s): ${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}2
    Log    Memory
    ${output}    Execute Command    free -mh | grep Mem
    Should Contain     ${output}    Mem:${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}3.9G
    Log    DISK
    ${output}    Execute Command    df -h | grep rootfs
    Should Contain     ${output}    rootfs${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}20G
    Log    Reached this point despite of error
test_m1_large
    Open Connection    ${HOST}
    ${resp}    Login With Public Key    ${username}    ${ID_RSA}
    Should Contain    ${resp}    Last login
    Log    CPU(s)
    ${output}    Execute Command    lscpu | grep CPU
    Should Contain     ${output}    CPU(s): ${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}4
    Log    Memory
    ${output}    Execute Command    free -mh | grep Mem
    Should Contain     ${output}    Mem:${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}7.8G
    Log    DISK
    ${output}    Execute Command    df -h | grep rootfs
    Should Contain     ${output}    rootfs${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}40G
    Log    Reached this point despite of error
test_m1_xlarge
    Open Connection    ${HOST}
    ${resp}    Login With Public Key    ${username}    ${ID_RSA}
    Should Contain    ${resp}    Last login
    Log    CPU(s)
    ${output}    Execute Command    lscpu | grep CPU
    Should Contain     ${output}    CPU(s): ${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}8
    Log    Memory
    ${output}    Execute Command    free -mh | grep Mem
    Should Contain     ${output}    Mem:${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}15G
    Log    DISK
    ${output}    Execute Command    df -h | grep rootfs
    Should Contain     ${output}    rootfs${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}${SPACE}79G
    Log    Reached this point despite of error

